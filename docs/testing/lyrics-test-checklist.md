# 歌词功能测试清单

## 📋 测试概览

**功能名称**: 歌词（Lyrics）  
**版本**: v0.2.0 (Unreleased)  
**测试日期**: 2026-02-08  
**测试环境**: Chrome 130 + Safari 17

---

## ✅ 单元测试（Core Library）

### Parser 测试

| 测试用例 | 状态 | 说明 |
|---------|------|------|
| 基本歌词解析 | ✅ PASS | 一字对一音，验证文本和 isPlaceholder |
| 分组歌词 | ✅ PASS | `(我的)` 多字对一音，验证 isGroup 标志 |
| 占位符 | ✅ PASS | `_` 和 `-` 占位符，text 为空字符串 |
| 数量不匹配检测 | ✅ PASS | 歌词数量与音符不匹配时报错 |
| 多小节关联 | ✅ PASS | 歌词正确分配到多个小节 |
| 跳过倚音 | ✅ PASS | 倚音不分配歌词 |
| 多行歌词合并 | ✅ PASS | 多个 @ 行自动合并 |
| 休止符处理 | ✅ PASS | 歌词数量计算时排除休止符 |

**测试结果**: 45/45 通过（包含原有 37 个测试 + 新增 8 个歌词测试）

---

## 🎯 功能测试（Web Application）

### 1. 基本渲染

#### 1.1 一字对一音
- [ ] 输入 `P 1 2 3 4 | C 一 二 三 四`
- [ ] 验证每个音符下方显示对应汉字
- [ ] 验证字体大小正确（约为音符的 85%）
- [ ] 验证垂直位置（音符下方约 10px）

#### 1.2 分组显示
- [ ] 输入 `P 1 2 3 4 | C (我的) 祖 国 心`
- [ ] 验证 "我的" 作为一个整体居中显示在音符 1 下方
- [ ] 验证分组文本字号略小于单字

#### 1.3 占位符
- [ ] 输入 `P 1 2 3 4 | C 星 _ _ 光`
- [ ] 验证音符 2、3 下方无歌词显示
- [ ] 验证音符 1、4 下方显示 "星"、"光"

---

### 2. 示例验证

#### 2.1 小星星
- [ ] 切换到 "小星星" 示例
- [ ] 验证三行歌词完整显示：
  - 第 1 行：一闪一闪亮晶晶（8 个字，第 8 个是占位符）
  - 第 2 行：满天都是小星星（8 个字）
  - 第 3 行：挂在天上放光明（8 个字）
  - 第 4 行：好像许多小眼睛（8 个字）
  - 第 5 行：一闪一闪亮晶晶（8 个字）
  - 第 6 行：满天都是小星星（8 个字）
- [ ] 验证歌词与音符对齐正确

#### 2.2 生日快乐
- [ ] 切换到 "生日快乐" 示例
- [ ] 验证四行歌词：
  - 第 1 行：祝你生日快乐（6 个字 + 1 占位符）
  - 第 2 行：祝你生日快乐（6 个字 + 1 占位符）
  - 第 3 行：祝你生日快乐（7 个字）
  - 第 4 行：祝你生日快乐（6 个字 + 1 占位符）

---

### 3. 播放交互

#### 3.1 高亮效果
- [ ] 播放小星星
- [ ] 验证当前音符对应的歌词变为红色（#DC2626）
- [ ] 验证已播放音符对应的歌词变为灰色（#78716C）
- [ ] 验证未播放音符对应的歌词为深灰色（#57534E）

#### 3.2 占位符音符
- [ ] 播放含占位符的歌词（如生日快乐）
- [ ] 验证占位符对应的音符播放时，无歌词高亮（因为不显示）
- [ ] 验证高亮正确跳过占位符音符

---

### 4. 错误处理

#### 4.1 数量不匹配警告
- [ ] 输入 `P 1 2 3 4 | C 一 二`
- [ ] 验证编辑器顶部显示橙色警告横幅
- [ ] 验证警告消息包含 "歌词数量（2）与有效音符数量（4）不匹配"
- [ ] 验证曲谱仍然渲染（警告不阻止渲染）

#### 4.2 缺少歌词
- [ ] 输入 `P 1 2 3 4 |`（无 C 行）
- [ ] 验证音符正常渲染，下方无歌词
- [ ] 验证无错误提示

---

### 5. 边界情况

#### 5.1 空歌词行
- [ ] 输入 `P 1 2 3 4 | C`（C 后无内容）
- [ ] 验证数量不匹配警告（0 个歌词 vs 4 个音符）

#### 5.2 多余空格
- [ ] 输入 `P 1 2 3 4 | C   一   二   三   四  `
- [ ] 验证歌词正常解析（空格被正确处理）

#### 5.3 未闭合括号
- [ ] 输入 `P 1 2 3 4 | C (我的 祖 国`
- [ ] 验证 "(我的 祖 国" 作为一个分组（自动闭合到行末）

#### 5.4 倚音场景
- [ ] 输入 `P 1 ^2_ 3 4 | C 一 二 三`
- [ ] 验证倚音 2 不分配歌词
- [ ] 验证数量不匹配警告（3 个歌词 vs 3 个有效音符）

#### 5.5 休止符场景
- [ ] 输入 `P 1 0 3 4 | C 一 二 三`
- [ ] 验证休止符不分配歌词
- [ ] 验证数量不匹配警告（3 个歌词 vs 3 个有效音符，休止符被跳过）

---

### 6. 文档验证

#### 6.1 帮助模态框
- [ ] 点击顶部栏 "?" 按钮
- [ ] 验证 "10. 歌词（Lyrics）✨" 章节存在
- [ ] 验证示例代码清晰展示：
  - 一字对一音：`@ 一 闪 一 闪`
  - 多字对一音：`@ (我的) 祖 国`
  - 占位符：`@ 星 _ - 光`
- [ ] 验证完整示例包含小星星第一行

#### 6.2 用户指南
- [ ] 打开 `docs/user-guide/notation-syntax.md`
- [ ] 验证 "11. 歌词（Lyrics）" 章节存在
- [ ] 验证包含以下子章节：
  - 11.1 基本语法
  - 11.2 分组：多字对一音
  - 11.3 占位符
  - 11.4 完整示例
  - 11.5 多行歌词
  - 11.6 规则说明

---

## 🎨 视觉回归测试

### 响应式布局
- [ ] 移动端（375px）：歌词字号自适应，不超出屏幕
- [ ] 平板端（768px）：歌词与音符对齐正确
- [ ] 桌面端（1920px）：歌词位置准确

### 字体渲染
- [ ] 中文字符清晰可读
- [ ] 分组文本 `(多字)` 不显示括号，只显示内容
- [ ] 占位符不渲染任何内容

---

## 📊 性能测试

### 大规模歌词
- [ ] 创建 20 小节 × 4 音符 = 80 个音符 + 80 个歌词
- [ ] 验证渲染时间 < 100ms
- [ ] 验证滚动流畅，无卡顿

### 内存占用
- [ ] 加载小星星示例（含歌词）
- [ ] 验证内存增长 < 5MB（相比无歌词版本）

---

## 🐛 已知限制

1. **多声部歌词**：当前不支持为同一行音符添加多行歌词（如合唱的不同声部）
2. **歌词跨行**：歌词不支持自动换行，长文本可能超出边界
3. **特殊符号**：`(` `)` `_` 是保留字符，无法作为普通歌词内容
4. **延长线不再作为占位符**：`-` 在歌词中不再用作占位符，避免与延长线符号混淆，统一使用 `_`

---

## 📝 测试结论

**测试状态**: 待执行  
**测试者**: （待填写）  
**通过率**: -/-  
**阻塞问题**: 无  
**建议**: 
- 在实际设备上验证触摸交互
- 测试不同字体下的渲染效果
- 验证无障碍功能（屏幕阅读器支持）

---

**测试完成时间**: （待填写）  
**签署**: （待填写）
